<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å•è¯ç®¡ç†ä¸é»˜å†™&å¬å†™ç³»ç»Ÿ</title>
  <style>
    body{font-family:sans-serif;margin:0;padding:0;background:#f9f9f9}
    header{background:#4CAF50;color:#fff;padding:10px;text-align:center}
    nav{display:flex;justify-content:center;background:#333}
    nav button{background:none;border:none;color:#fff;padding:12px 16px;cursor:pointer}
    nav button:hover{background:#575757}
    .container{padding:20px}
    .hidden{display:none}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#f2f2f2}
    .input-word{width:80%;padding:4px}
    .btn{margin-top:10px;padding:6px 12px;cursor:pointer}
    .play-btn{margin-right:8px;cursor:pointer}
  </style>
</head>
<body>
  <header><h1>å•è¯ç®¡ç†ä¸é»˜å†™&å¬å†™ç³»ç»Ÿ</h1></header>
  <nav>
    <button onclick="showSection('words')">å•è¯ç®¡ç†</button>
    <button onclick="showSection('dictate')">é»˜å†™ç»ƒä¹ </button>
    <button onclick="showSection('listen')">å¬å†™ç»ƒä¹ </button>
    <button onclick="showSection('review')">å¤ä¹ ç³»ç»Ÿ</button>
  </nav>
  <div class="container">
    <!-- ç®¡ç† -->
    <section id="words">
      <h2>å•è¯ç®¡ç†</h2>
      <table id="wordManageTable">
        <thead><tr><th>å•è¯</th><th>ä¸­æ–‡é‡Šä¹‰</th><th>å¤‡æ³¨/ç¬”è®°</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
    <!-- é»˜å†™ -->
    <section id="dictate" class="hidden">
      <h2>é»˜å†™ç»ƒä¹ </h2>
      <label>é€‰æ‹©æ—¥æœŸ: <select id="dictDate"></select></label>
      <div id="dictForm"></div>
      <button class="btn" onclick="gradeDictation()">å®Œæˆå¹¶æ‰¹æ”¹</button>
      <div id="dictResult"></div>
      <h3>å†å²æˆç»©</h3><div id="dictStats"></div>
    </section>
    <!-- å¬å†™ -->
    <section id="listen" class="hidden">
      <h2>å¬å†™ç»ƒä¹ </h2>
      <label>é€‰æ‹©æ—¥æœŸ: <select id="listenDate"></select></label>
      <div id="listenForm"></div>
      <button class="btn" onclick="gradeListening()">å®Œæˆå¹¶æ‰¹æ”¹</button>
      <div id="listenResult"></div>
      <h3>å†å²æˆç»©</h3><div id="listenStats"></div>
    </section>
    <!-- å¤ä¹  -->
    <section id="review" class="hidden">
      <h2>å¤ä¹ ç³»ç»Ÿ</h2>
      <button class="btn" onclick="loadReview()">åŠ è½½é”™è¯ç»„</button>
      <div id="reviewForm"></div>
      <button class="btn" onclick="gradeReview()">æäº¤å¤ä¹ </button>
      <div id="reviewResult"></div>
    </section>
  </div>
  <script>
    const data={
      '2025-08-01':[/*å®Œæ•´39è¯å¯¹è±¡åˆ—è¡¨*/]
    };
    const KEY_DICT='dictRecords',KEY_LISTEN='listenRecords',KEY_REVIEW='reviewList';
    function init(){
      // ç®¡ç†
      const tbody=document.querySelector('#wordManageTable tbody');
      Object.values(data)[0].forEach(item=>{
        const tr=document.createElement('tr');
        const note=localStorage.getItem(`note_${item.word}`)||'';
        tr.innerHTML=`<td>${item.word}</td><td>${item.meaning}</td>`+
                     `<td contenteditable onblur="saveNote('${item.word}',this.innerText)">${note}</td>`;
        tbody.appendChild(tr);
      });
      // é»˜å†™ & å¬å†™ æ—¥æœŸé€‰é¡¹
      ['dictDate','listenDate'].forEach(id=>{
        const sel=document.getElementById(id);
        Object.keys(data).forEach(d=>{sel.add(new Option(d,d));});
      });
      showSection('words');
      loadDictStats();loadListenStats();
    }
    function saveNote(w,t){localStorage.setItem(`note_${w}`,t);}
    function showSection(id){['words','dictate','listen','review'].forEach(s=>document.getElementById(s).classList.toggle('hidden',s!==id)); if(id==='dictate')buildDict(); if(id==='listen')buildListen(); if(id==='review')loadReview();}
    // é»˜å†™è¡¨å•
    function buildDict(){const d=document.getElementById('dictDate').value,cont=document.getElementById('dictForm');cont.innerHTML='';data[d].forEach((item,i)=>{cont.innerHTML+=`<div><label>${item.meaning}</label><input id=d${i} class=input-word></div>`;});}
    function gradeDictation(){const d=document.getElementById('dictDate').value,rec=JSON.parse(localStorage.getItem(KEY_DICT)||'[]');let c=0,errs=[];data[d].forEach((item,i)=>{let a=document.getElementById('d'+i).value.trim().toLowerCase();if(a===item.word) c++;else errs.push({word:item.word,meaning:item.meaning});});rec.push({date:d,total:data[d].length,correct:c});localStorage.setItem(KEY_DICT,JSON.stringify(rec));loadDictStats();addToReview(errs);document.getElementById('dictResult').innerText=`${d}ï¼š${c}/${data[d].length}`;}
    function loadDictStats(){const rec=JSON.parse(localStorage.getItem(KEY_DICT)||'[]'),el=document.getElementById('dictStats');el.innerHTML='';rec.forEach(r=>el.innerHTML+=`<p>${r.date} ${r.correct}/${r.total}</p>`);}    
    // å¬å†™è¡¨å•
    function buildListen(){const d=document.getElementById('listenDate').value,cont=document.getElementById('listenForm');cont.innerHTML='';data[d].forEach((item,i)=>{cont.innerHTML+=`<div><button class=play-btn onclick="speak('${item.word}')">ğŸ”Š</button><input id=l${i} class=input-word placeholder='å¬å†™è‹±æ–‡'></div>`;});}
    function gradeListening(){const d=document.getElementById('listenDate').value,rec=JSON.parse(localStorage.getItem(KEY_LISTEN)||'[]');let c=0,errs=[];data[d].forEach((item,i)=>{let a=document.getElementById('l'+i).value.trim().toLowerCase();if(a===item.word) c++;else errs.push({word:item.word,meaning:item.meaning});});rec.push({date:d,total:data[d].length,correct:c});localStorage.setItem(KEY_LISTEN,JSON.stringify(rec));loadListenStats();addToReview(errs);document.getElementById('listenResult').innerText=`${d}ï¼š${c}/${data[d].length}`;}
    function loadListenStats(){const rec=JSON.parse(localStorage.getItem(KEY_LISTEN)||'[]'),el=document.getElementById('listenStats');el.innerHTML='';rec.forEach(r=>el.innerHTML+=`<p>${r.date} ${r.correct}/${r.total}</p>`);}    
    // å¤ä¹ 
    function addToReview(arr){let list=JSON.parse(localStorage.getItem(KEY_REVIEW)||'[]');list=list.concat(arr);localStorage.setItem(KEY_REVIEW,JSON.stringify(list));}
    function loadReview(){const list=JSON.parse(localStorage.getItem(KEY_REVIEW)||'[]'),form=document.getElementById('reviewForm');form.innerHTML='';list.slice(0,20).forEach((item,i)=>{form.innerHTML+=`<div><button class=play-btn onclick="speak('${item.word}')">ğŸ”Š</button><label>${item.meaning}</label><input id=r${i} class=input-word></div>`;});}
    function gradeReview(){let list=JSON.parse(localStorage.getItem(KEY_REVIEW)||'[]'),group=list.slice(0,20),remain=list.slice(20),errs=[];group.forEach((item,i)=>{let a=document.getElementById('r'+i).value.trim().toLowerCase();if(a!==item.word) errs.push(item);} );localStorage.setItem(KEY_REVIEW,JSON.stringify(errs.concat(remain)));document.getElementById('reviewResult').innerText=`å‰©ä½™${errs.concat(remain).length}è¯`;}
    // TTS
    function speak(text){const u=new SpeechSynthesisUtterance(text);u.lang='en-US';speechSynthesis.speak(u);}    
    window.onload=init;
  </script>
</body>
</html>
