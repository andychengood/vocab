<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>单词管理与默写&听写系统</title>
  <style>
    body{font-family:sans-serif;margin:0;padding:0;background:#f9f9f9}
    header{background:#4CAF50;color:#fff;padding:10px;text-align:center}
    nav{display:flex;justify-content:center;background:#333}
    nav button{background:none;border:none;color:#fff;padding:12px 16px;cursor:pointer}
    nav button:hover{background:#575757}
    .container{padding:20px}
    .hidden{display:none}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#f2f2f2}
    .input-word{width:80%;padding:4px}
    .btn{margin-top:10px;padding:6px 12px;cursor:pointer}
    .play-btn{margin-right:8px;cursor:pointer}
  </style>
</head>
<body>
  <header><h1>单词管理与默写&听写系统</h1></header>
  <nav>
    <button onclick="showSection('words')">单词管理</button>
    <button onclick="showSection('dictate')">默写练习</button>
    <button onclick="showSection('listen')">听写练习</button>
    <button onclick="showSection('review')">复习系统</button>
  </nav>
  <div class="container">
    <!-- 管理 -->
    <section id="words">
      <h2>单词管理</h2>
      <table id="wordManageTable">
        <thead><tr><th>单词</th><th>中文释义</th><th>备注/笔记</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
    <!-- 默写 -->
    <section id="dictate" class="hidden">
      <h2>默写练习</h2>
      <label>选择日期: <select id="dictDate"></select></label>
      <div id="dictForm"></div>
      <button class="btn" onclick="gradeDictation()">完成并批改</button>
      <div id="dictResult"></div>
      <h3>历史成绩</h3><div id="dictStats"></div>
    </section>
    <!-- 听写 -->
    <section id="listen" class="hidden">
      <h2>听写练习</h2>
      <label>选择日期: <select id="listenDate"></select></label>
      <div id="listenForm"></div>
      <button class="btn" onclick="gradeListening()">完成并批改</button>
      <div id="listenResult"></div>
      <h3>历史成绩</h3><div id="listenStats"></div>
    </section>
    <!-- 复习 -->
    <section id="review" class="hidden">
      <h2>复习系统</h2>
      <button class="btn" onclick="loadReview()">加载错词组</button>
      <div id="reviewForm"></div>
      <button class="btn" onclick="gradeReview()">提交复习</button>
      <div id="reviewResult"></div>
    </section>
  </div>
  <script>
    const data={
      '2025-08-01':[/*完整39词对象列表*/]
    };
    const KEY_DICT='dictRecords',KEY_LISTEN='listenRecords',KEY_REVIEW='reviewList';
    function init(){
      // 管理
      const tbody=document.querySelector('#wordManageTable tbody');
      Object.values(data)[0].forEach(item=>{
        const tr=document.createElement('tr');
        const note=localStorage.getItem(`note_${item.word}`)||'';
        tr.innerHTML=`<td>${item.word}</td><td>${item.meaning}</td>`+
                     `<td contenteditable onblur="saveNote('${item.word}',this.innerText)">${note}</td>`;
        tbody.appendChild(tr);
      });
      // 默写 & 听写 日期选项
      ['dictDate','listenDate'].forEach(id=>{
        const sel=document.getElementById(id);
        Object.keys(data).forEach(d=>{sel.add(new Option(d,d));});
      });
      showSection('words');
      loadDictStats();loadListenStats();
    }
    function saveNote(w,t){localStorage.setItem(`note_${w}`,t);}
    function showSection(id){['words','dictate','listen','review'].forEach(s=>document.getElementById(s).classList.toggle('hidden',s!==id)); if(id==='dictate')buildDict(); if(id==='listen')buildListen(); if(id==='review')loadReview();}
    // 默写表单
    function buildDict(){const d=document.getElementById('dictDate').value,cont=document.getElementById('dictForm');cont.innerHTML='';data[d].forEach((item,i)=>{cont.innerHTML+=`<div><label>${item.meaning}</label><input id=d${i} class=input-word></div>`;});}
    function gradeDictation(){const d=document.getElementById('dictDate').value,rec=JSON.parse(localStorage.getItem(KEY_DICT)||'[]');let c=0,errs=[];data[d].forEach((item,i)=>{let a=document.getElementById('d'+i).value.trim().toLowerCase();if(a===item.word) c++;else errs.push({word:item.word,meaning:item.meaning});});rec.push({date:d,total:data[d].length,correct:c});localStorage.setItem(KEY_DICT,JSON.stringify(rec));loadDictStats();addToReview(errs);document.getElementById('dictResult').innerText=`${d}：${c}/${data[d].length}`;}
    function loadDictStats(){const rec=JSON.parse(localStorage.getItem(KEY_DICT)||'[]'),el=document.getElementById('dictStats');el.innerHTML='';rec.forEach(r=>el.innerHTML+=`<p>${r.date} ${r.correct}/${r.total}</p>`);}    
    // 听写表单
    function buildListen(){const d=document.getElementById('listenDate').value,cont=document.getElementById('listenForm');cont.innerHTML='';data[d].forEach((item,i)=>{cont.innerHTML+=`<div><button class=play-btn onclick="speak('${item.word}')">🔊</button><input id=l${i} class=input-word placeholder='听写英文'></div>`;});}
    function gradeListening(){const d=document.getElementById('listenDate').value,rec=JSON.parse(localStorage.getItem(KEY_LISTEN)||'[]');let c=0,errs=[];data[d].forEach((item,i)=>{let a=document.getElementById('l'+i).value.trim().toLowerCase();if(a===item.word) c++;else errs.push({word:item.word,meaning:item.meaning});});rec.push({date:d,total:data[d].length,correct:c});localStorage.setItem(KEY_LISTEN,JSON.stringify(rec));loadListenStats();addToReview(errs);document.getElementById('listenResult').innerText=`${d}：${c}/${data[d].length}`;}
    function loadListenStats(){const rec=JSON.parse(localStorage.getItem(KEY_LISTEN)||'[]'),el=document.getElementById('listenStats');el.innerHTML='';rec.forEach(r=>el.innerHTML+=`<p>${r.date} ${r.correct}/${r.total}</p>`);}    
    // 复习
    function addToReview(arr){let list=JSON.parse(localStorage.getItem(KEY_REVIEW)||'[]');list=list.concat(arr);localStorage.setItem(KEY_REVIEW,JSON.stringify(list));}
    function loadReview(){const list=JSON.parse(localStorage.getItem(KEY_REVIEW)||'[]'),form=document.getElementById('reviewForm');form.innerHTML='';list.slice(0,20).forEach((item,i)=>{form.innerHTML+=`<div><button class=play-btn onclick="speak('${item.word}')">🔊</button><label>${item.meaning}</label><input id=r${i} class=input-word></div>`;});}
    function gradeReview(){let list=JSON.parse(localStorage.getItem(KEY_REVIEW)||'[]'),group=list.slice(0,20),remain=list.slice(20),errs=[];group.forEach((item,i)=>{let a=document.getElementById('r'+i).value.trim().toLowerCase();if(a!==item.word) errs.push(item);} );localStorage.setItem(KEY_REVIEW,JSON.stringify(errs.concat(remain)));document.getElementById('reviewResult').innerText=`剩余${errs.concat(remain).length}词`;}
    // TTS
    function speak(text){const u=new SpeechSynthesisUtterance(text);u.lang='en-US';speechSynthesis.speak(u);}    
    window.onload=init;
  </script>
</body>
</html>
