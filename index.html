<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ¯æ—¥å•è¯</title>
<style>
body{font-family:sans-serif;margin:0;background:#f5f5f5}
header{background:#4caf50;color:#fff;text-align:center;padding:12px}
nav{display:flex;background:#333}nav button{flex:1;padding:10px;border:none;color:#fff;background:none;cursor:pointer}nav button:hover{background:#575757}
.container{padding:18px}section{display:none}.show{display:block}
table{width:100%;border-collapse:collapse;margin-top:12px}th,td{border:1px solid #ccc;padding:8px}th{background:#eee}
textarea{width:100%;height:60px;margin-top:8px}.in{width:70%;padding:4px;margin-top:4px}
.btn{margin:8px 0;padding:6px 14px}.play{cursor:pointer;margin-right:6px}.del{color:red;cursor:pointer}
ul{padding-left:20px;color:red}
</style></head><body>
<header><h1>æ¯æ—¥å•è¯ Â· ç®¡ç† / é»˜å†™ / å¬å†™ / å¤ä¹ </h1></header>

<nav>
  <button data-tab="m">å•è¯ç®¡ç†</button>
  <button data-tab="d">é»˜å†™ç»ƒä¹ </button>
  <button data-tab="l">å¬å†™ç»ƒä¹ </button>
  <button data-tab="r">å¤ä¹ ç³»ç»Ÿ</button>
</nav>

<div class="container">
<!-- ç®¡ç† -->
<section id="m" class="show">
  æ—¥æœŸ <input type="date" id="date"><br>
  <textarea id="bulk" placeholder="ç²˜è´´å¤šä¸ªå•è¯ï¼Œå¯éšæ„ç”¨ ç©ºæ ¼ / å›è½¦ / æ ‡ç‚¹ åˆ†éš”"></textarea>
  <button id="add" class="btn">æ‰¹é‡æ·»åŠ </button>
  <table><thead><tr><th>å•è¯</th><th>ä¸­æ–‡é‡Šä¹‰</th><th>å¤‡æ³¨</th><th>é»˜å†™</th><th>å¬å†™</th><th>åˆ </th></tr></thead><tbody id="tb"></tbody></table>
</section>

<!-- é»˜å†™ -->
<section id="d"><h2>é»˜å†™ç»ƒä¹ </h2>
  æ—¥æœŸ <input type="date" id="dDay">
  <button id="dGo" class="btn">å¼€å§‹</button>
  <div id="dForm"></div>
  <button id="dChk" class="btn">æ‰¹æ”¹</button>
  <div id="dRes"></div>
</section>

<!-- å¬å†™ -->
<section id="l"><h2>å¬å†™ç»ƒä¹ </h2>
  æ—¥æœŸ <input type="date" id="lDay">
  <button id="lGo" class="btn">å¼€å§‹</button>
  <div id="lForm"></div>
  <button id="lChk" class="btn">æ‰¹æ”¹</button>
  <div id="lRes"></div>
</section>

<!-- å¤ä¹  -->
<section id="r"><h2>å¤ä¹ ç³»ç»Ÿ</h2>
  <button id="rLoad" class="btn">åŠ è½½é”™è¯</button>
  <div id="rForm"></div>
  <button id="rChk" class="btn">æ‰¹æ”¹</button>
  <div id="rRes"></div>
</section>
</div>

<script>
/* ---------- æœ¬åœ°å­˜å‚¨ ---------- */
const KEY='vocabByDate', KR='reviewWords';
let DATA=JSON.parse(localStorage.getItem(KEY)||'{}');
const today=new Date().toISOString().slice(0,10);
['date','dDay','lDay'].forEach(id=>document.getElementById(id).value=today);
if(!DATA[today]) DATA[today]=[]; save();
function save(){localStorage.setItem(KEY,JSON.stringify(DATA));}
const $=id=>document.getElementById(id);
const list=d=>DATA[d];

/* ---------- å·¥å…· ---------- */
const englishWords = str => (str.match(/[A-Za-z]+(?:'[A-Za-z]+)?/g)||[]);  // æå–çº¯è‹±æ–‡å•è¯
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}};
async function cn(word){
  try{const j=await(await fetch(`https://api.shanbay.com/bdc/search/?word=${encodeURIComponent(word)}`)).json();
      if(j.data?.cn_definition?.defn) return j.data.cn_definition.defn;}catch{}
  try{const url=`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=zh-CN&dt=t&q=${encodeURIComponent(word)}`;
      const a=await (await fetch(url)).json(); return a[0][0][0]; }catch{}
  return '';
}
function speak(w){const u=new SpeechSynthesisUtterance(w);u.voice=speechSynthesis.getVoices().find(v=>/^en/i.test(v.lang))||null;speechSynthesis.speak(u);}

/* ---------- æ ‡ç­¾åˆ‡æ¢ ---------- */
document.querySelectorAll('nav button').forEach(b=>b.onclick=()=>{document.querySelectorAll('section').forEach(s=>s.classList.remove('show'));$(b.dataset.tab).classList.add('show');});

/* ---------- è¡¨æ ¼ ---------- */
function draw(){
 const d=$('date').value;if(!DATA[d]) DATA[d]=[];
 const body=$('tb');body.innerHTML='';
 list(d).forEach((it,i)=>{
  body.insertAdjacentHTML('beforeend',`<tr>
    <td>${it.w}</td><td>${it.c}</td>
    <td contenteditable onblur="list('${d}')[${i}].n=this.innerText;save();">${it.n||''}</td>
    <td><input type=checkbox ${it.d?'checked':''} onchange="list('${d}')[${i}].d=this.checked;save();"></td>
    <td><input type=checkbox ${it.l?'checked':''} onchange="list('${d}')[${i}].l=this.checked;save();"></td>
    <td><span class=del onclick="list('${d}').splice(${i},1);save();draw();">ğŸ—‘ï¸</span></td>
  </tr>`);
 });
}
$('date').onchange=draw; draw();

/* ---------- æ‰¹é‡æ·»åŠ  ---------- */
$('add').onclick=async()=>{
 const d=$('date').value, raw=$('bulk').value.trim();$('bulk').value='';
 if(!raw) return;
 for(const w of englishWords(raw)){
   if(list(d).some(x=>x.w===w)) continue;
   let c=await cn(w);
   if(!c){c=prompt(`"${w}" çš„ä¸­æ–‡:`,'');if(!c)continue;}
   list(d).push({w,c});
 }
 save(); draw();
};

/* ---------- é»˜å†™ ---------- */
$('dGo').onclick=()=>{const d=$('dDay').value,arr=[...list(d)];shuffle(arr);$('dForm').innerHTML='';arr.forEach((it,i)=>$('dForm').insertAdjacentHTML('beforeend',`${it.c}<input id=dx${i} class=in><br>`));$('dForm').dataset.arr=JSON.stringify(arr);}
$('dChk').onclick=()=>{const arr=JSON.parse($('dForm').dataset.arr||'[]'),d=$('dDay').value;let ok=0,err=[];arr.forEach((it,i)=>{const a=$('dx'+i).value.trim().toLowerCase();const real=list(d).find(x=>x.w===it.w);if(a===it.w.toLowerCase()){ok++;real.d=true}else{real.d=false;err.push(it)}});save();draw();addR(err);$('dRes').innerHTML=`æ­£ç¡® ${ok}/${arr.length}${err.length?'<ul>'+err.map(e=>'<li>'+e.w+'</li>').join('')+'</ul>':''}`}

/* ---------- å¬å†™ ---------- */
$('lGo').onclick=()=>{const d=$('lDay').value,arr=[...list(d)];shuffle(arr);$('lForm').innerHTML='';arr.forEach((it,i)=>$('lForm').insertAdjacentHTML('beforeend',`<button class=play onclick="speak('${it.w}')">ğŸ”Š</button><input id=lx${i} class=in><br>`));$('lForm').dataset.arr=JSON.stringify(arr);}
$('lChk').onclick=()=>{const arr=JSON.parse($('lForm').dataset.arr||'[]'),d=$('lDay').value;let ok=0,err=[];arr.forEach((it,i)=>{const a=$('lx'+i).value.trim().toLowerCase();const real=list(d).find(x=>x.w===it.w);if(a===it.w.toLowerCase()){ok++;real.l=true}else{real.l=false;err.push(it)}});save();draw();addR(err);$('lRes').innerHTML=`æ­£ç¡® ${ok}/${arr.length}${err.length?'<ul>'+err.map(e=>'<li>'+e.w+'</li>').join('')+'</ul>':''}`}

/* ---------- å¤ä¹  ---------- */
function addR(e){if(!e.length)return;const r=JSON.parse(localStorage.getItem(KR)||'[]');localStorage.setItem(KR,JSON.stringify(r.concat(e)));}
$('rLoad').onclick=()=>{const r=JSON.parse(localStorage.getItem(KR)||'[]');$('rForm').innerHTML='';r.slice(0,20).forEach((it,i)=>$('rForm').insertAdjacentHTML('beforeend',`<button class=play onclick="speak('${it.w}')">ğŸ”Š</button>${it.c}<input id=rx${i} class=in><br>`));}
$('rChk').onclick=()=>{let r=JSON.parse(localStorage.getItem(KR)||'[]');const grp=r.slice(0,20),rest=r.slice(20),left=[];grp.forEach((it,i)=>{const a=$('rx'+i).value.trim().toLowerCase();if(a!==it.w.toLowerCase())left.push(it)});localStorage.setItem(KR,JSON.stringify(left.concat(rest)));$('rRes').innerText='å‰©ä½™ '+(left.concat(rest)).length;}
</script>
</body></html>
