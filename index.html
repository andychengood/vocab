<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>æ¯æ—¥å•è¯</title>
<style>
 body{font-family:sans-serif;margin:0;background:#f5f5f5}
 header{background:#4caf50;color:#fff;text-align:center;padding:12px}
 nav{display:flex;background:#333} nav button{flex:1;padding:10px;color:#fff;border:none;background:none;cursor:pointer}
 nav button:hover{background:#575757}
 .box{padding:18px} section{display:none}.show{display:block}
 table{width:100%;border-collapse:collapse;margin-top:12px}
 th,td{border:1px solid #ccc;padding:8px;text-align:left}
 th{background:#eee} textarea{width:100%;height:60px;margin-top:8px}
 .in{width:70%;padding:4px} .btn{margin:8px 0;padding:6px 14px}
 .play{cursor:pointer;margin-right:6px} .del{cursor:pointer;color:red}
</style></head>
<body>
<header><h1>æ¯æ—¥å•è¯ Â· ç®¡ç† / é»˜å†™ / å¬å†™ / å¤ä¹ </h1></header>
<nav>
 <button data-tab="m">å•è¯ç®¡ç†</button>
 <button data-tab="d">é»˜å†™ç»ƒä¹ </button>
 <button data-tab="l">å¬å†™ç»ƒä¹ </button>
 <button data-tab="r">å¤ä¹ ç³»ç»Ÿ</button>
</nav>

<div class="box">

<!-- ç®¡ç† -->
<section id="m" class="show">
 <h2>å•è¯ç®¡ç†</h2>
 æ—¥æœŸï¼š<input type="date" id="date">
 <textarea id="bulk" placeholder="åœ¨æ­¤è¾“å…¥å•è¯ï¼Œç”¨ç©ºæ ¼éš”å¼€"></textarea>
 <button id="add" class="btn">æ‰¹é‡æ·»åŠ </button>
 <table><thead><tr><th>å•è¯</th><th>ä¸­æ–‡é‡Šä¹‰</th><th>å¤‡æ³¨</th><th>é»˜å†™</th><th>å¬å†™</th><th>åˆ </th></tr></thead>
 <tbody id="table"></tbody></table>
</section>

<!-- é»˜å†™ -->
<section id="d">
 <h2>é»˜å†™ç»ƒä¹ </h2>
 æ—¥æœŸï¼š<input type="date" id="dDate">
 <button id="dStart" class="btn">å¼€å§‹</button>
 <div id="dForm"></div>
 <button id="dGrade" class="btn">æ‰¹æ”¹</button>
 <div id="dRes"></div>
</section>

<!-- å¬å†™ -->
<section id="l">
 <h2>å¬å†™ç»ƒä¹ </h2>
 æ—¥æœŸï¼š<input type="date" id="lDate">
 <button id="lStart" class="btn">å¼€å§‹</button>
 <div id="lForm"></div>
 <button id="lGrade" class="btn">æ‰¹æ”¹</button>
 <div id="lRes"></div>
</section>

<!-- å¤ä¹  -->
<section id="r">
 <h2>å¤ä¹ ç³»ç»Ÿ</h2>
 <button id="rLoad" class="btn">åŠ è½½é”™è¯</button>
 <div id="rForm"></div>
 <button id="rGrade" class="btn">æ‰¹æ”¹</button>
 <div id="rRes"></div>
</section>

</div>

<script>
/* === åŸºç¡€æ•°æ® === */
const KEY="vocabByDate",KEY_R="reviewWords";
let DATA=JSON.parse(localStorage.getItem(KEY)||'{}');
const today=new Date().toISOString().slice(0,10);
['date','dDate','lDate'].forEach(id=>document.getElementById(id).value=today);
if(!DATA[today]){DATA[today]=[]} save();

/* === å·¥å…· === */
const $=id=>document.getElementById(id);
const shuffle=arr=>{for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}};
const list=d=>DATA[d];

/* é¡µç­¾åˆ‡æ¢ */
document.querySelectorAll('nav button').forEach(b=>b.onclick=()=>{document.querySelectorAll('section').forEach(s=>s.classList.remove('show'));$(b.dataset.tab).classList.add('show');});

/* æ¸²æŸ“è¡¨ */
function draw(){
 const d=$('date').value, body=$('table'); body.innerHTML='';
 list(d).forEach((it,i)=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${it.w}</td><td>${it.c}</td>
   <td contenteditable onblur="list('${d}')[${i}].n=this.innerText;save();">${it.n||''}</td>
   <td><input type=checkbox ${it.d?'checked':''} onchange="list('${d}')[${i}].d=this.checked;save();"></td>
   <td><input type=checkbox ${it.l?'checked':''} onchange="list('${d}')[${i}].l=this.checked;save();"></td>
   <td><span class=del onclick="list('${d}').splice(${i},1);save();draw();">ğŸ—‘ï¸</span></td>`;
  body.appendChild(tr);
 });
}
$('date').onchange=draw; draw();

/* ä¿å­˜ */
function save(){localStorage.setItem(KEY,JSON.stringify(DATA));}

/* æ‰¹é‡æ·»åŠ  */
$('add').onclick=()=>{
 const d=$('date').value; const raw=$('bulk').value.trim();
 const words=raw.split(/[\\s\\u00A0]+/); $('bulk').value='';
 words.forEach(w=>{
  if(!w||list(d).some(x=>x.w===w))return;
  let c=prompt(`è¯·è¾“å…¥ "${w}" çš„ä¸­æ–‡é‡Šä¹‰:`,'');
  if(!c)return;
  list(d).push({w,c});
 });
 save(); draw();
}

/* å‘éŸ³ï¼ˆçº¯ç³»ç»Ÿ Voiceï¼Œç¡®ä¿ä»»ä½•ç½‘ç»œéƒ½èƒ½æ’­ï¼‰ */
function speak(w){
 const u=new SpeechSynthesisUtterance(w);
 const v=speechSynthesis.getVoices().find(v=>/^en/i.test(v.lang))||null;
 u.voice=v; u.rate=1; u.pitch=1; speechSynthesis.speak(u);
}

/* é»˜å†™ */
$('dStart').onclick=()=>{const d=$('dDate').value,arr=[...list(d)];shuffle(arr);const f=$('dForm');f.innerHTML='';arr.forEach((it,i)=>f.innerHTML+=`${it.c}<input id=d${i} class=in><br>`);f.dataset.arr=JSON.stringify(arr);}
$('dGrade').onclick=()=>{const arr=JSON.parse($('dForm').dataset.arr||'[]'),d=$('dDate').value;let ok=0,err=[];arr.forEach((it,i)=>{const a=$('d'+i).value.trim().toLowerCase();const real=list(d).find(x=>x.w===it.w);if(a===it.w.toLowerCase()){ok++;real.d=true}else{real.d=false;err.push(it)}});save();draw();addR(err);$('dRes').innerHTML=`æ­£ç¡® ${ok}/${arr.length}${err.length?'<ul>'+err.map(e=>'<li>'+e.w+'</li>').join('')+'</ul>':''}`}

/* å¬å†™ */
$('lStart').onclick=()=>{const d=$('lDate').value,arr=[...list(d)];shuffle(arr);const f=$('lForm');f.innerHTML='';arr.forEach((it,i)=>f.innerHTML+=`<button class=play onclick="speak('${it.w}')">ğŸ”Š</button><input id=l${i} class=in><br>`);f.dataset.arr=JSON.stringify(arr);}
$('lGrade').onclick=()=>{const arr=JSON.parse($('lForm').dataset.arr||'[]'),d=$('lDate').value;let ok=0,err=[];arr.forEach((it,i)=>{const a=$('l'+i).value.trim().toLowerCase();const real=list(d).find(x=>x.w===it.w);if(a===it.w.toLowerCase()){ok++;real.l=true}else{real.l=false;err.push(it)}});save();draw();addR(err);$('lRes').innerHTML=`æ­£ç¡® ${ok}/${arr.length}${err.length?'<ul>'+err.map(e=>'<li>'+e.w+'</li>').join('')+'</ul>':''}`}

/* å¤ä¹  */
function addR(arr){if(!arr.length)return;const r=JSON.parse(localStorage.getItem(KEY_R)||'[]');localStorage.setItem(KEY_R,JSON.stringify(r.concat(arr))); }
$('rLoad').onclick=()=>{const r=JSON.parse(localStorage.getItem(KEY_R)||'[]');const f=$('rForm');f.innerHTML='';r.slice(0,20).forEach((it,i)=>f.innerHTML+=`<button class=play onclick="speak('${it.w}')">ğŸ”Š</button>${it.c}<input id=r${i} class=in><br>`);}
$('rGrade').onclick=()=>{let r=JSON.parse(localStorage.getItem(KEY_R)||'[]');const grp=r.slice(0,20),rest=r.slice(20),left=[];grp.forEach((it,i)=>{const a=$('r'+i).value.trim().toLowerCase();if(a!==it.w.toLowerCase())left.push(it)});localStorage.setItem(KEY_R,JSON.stringify(left.concat(rest)));$('rRes').innerText='å‰©ä½™ '+(left.concat(rest)).length+' è¯';}
</script>
</body>
</html>
